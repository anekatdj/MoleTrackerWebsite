@page "/mainPage"

@using PW_BusinessLogicLayer.Interfaces
@using DataClasses.Domain
@using System.Drawing
@using System.Net.Mime
@using System.Diagnostics

@inject NavigationManager NavManager
@inject SessionInfo SessionInfo
@inject PatientInfo PatientInfo
@inject ILogInController LogInController


<link href="css/CSSStyles.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" /> @*EYE*@

@if (!SessionInfo.LoggedIn)
{
    NavManager.NavigateTo("/patientLogin");
}

<h1>Velkommen, @PatientInfo.Name</h1>

<p>Her kan du sammenligne de billeder, du har taget med MoleTracker, så du nemt og hurtigt kan se efter forandringer i dine modermærker.</p>

<div class="row align-items-start" style="height: auto; width: auto">

    <div class="col">
        <div class="tabelcontainer" style="overflow: scroll; height: 500px; width: 400px">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Personlige samlinger</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (Collection collection in collections)
                    {
                        <tr>
                            <td>@collection.CollectionName</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>


    <div class="col">
        @*padding og sticky*@
        <div style="width: 400px">
            <img src="@FrontOrBack" style="float: right; width:@Width; height: @Height;" /> @*onmousewheel="@MouseWheel"*@
            <button style="float:right" class="@Arrow" @onclick="TurnAroundModel"></button>

        </div>
    </div>

    @*636*1431 billedstørrelse*@



</div>

<div class="col align-self-end">
    @if (@ButtonPressed == false)
    {
        <button style="float: right; border-radius: 28px;" class="@AddCollectionButton" @onclick="AddNewCollection"></button>
    }
    @if (@ButtonPressed == true)
    {
        @if (PointClicked == false)
        {
            <button style="float: right; border-radius: 28px;" @onclick="NavigateToCollectionPage" disabled="@true">Godkendt</button>
            <p style="float: right; color: crimson; margin-right: 15px">Vælg placering af modermærke</p>
        }
    }

</div>

<p style="font-size: 10px">Bemærk venligst at MoleTracker ikke diagnosticerer hudkræft. Hvis du er bekymret for et eller flere modermærker, skal du kontakte din læge.</p>






@code {
    public string FrontOrBack = "/Images/MaleFrontCrop.png";
    public string Arrow = "fa fa-refresh";
    public string AddCollectionButton = "fa fa-plus";
    public string TurnAround { get; set; }
    public string Gender { get; set; }
    public string Width{ get; set; }
    public string Height{ get; set; }

    private IEnumerable<Collection> collections = new[]
    {
        new Collection {CollectionID = 1, CollectionName = "Venstre skulder", Location = new LocationOnBody(), PictureList = new List<PictureInfo>()},
        new Collection {CollectionID = 1, CollectionName = "Højre skulder", Location = new LocationOnBody(), PictureList = new List<PictureInfo>()},
        new Collection {CollectionID = 1, CollectionName = "Venstre fod", Location = new LocationOnBody(), PictureList = new List<PictureInfo>()},
        new Collection {CollectionID = 1, CollectionName = "Højre fod", Location = new LocationOnBody(), PictureList = new List<PictureInfo>()}
    };


    public void TurnAroundModel()
    {
        GetGender();

        if (Gender == "G")
        {

            if (this.FrontOrBack == "/Images/FemaleBackCrop.png")
            {
                this.FrontOrBack = "/Images/FemaleFrontcrop.png";
            }
            else
            {
                this.FrontOrBack = "/Images/FemaleBackCrop.png";
            }
        }

        else if (Gender == "B")
        {
            if (this.FrontOrBack == "/Images/MaleBackCrop.png")
            {
                this.FrontOrBack = "/Images/MaleFrontCrop.png";
            }
            else
            {
                this.FrontOrBack = "/Images/MaleBackCrop.png";
            }
        }
    }

    public void GetGender()
    {
        PatientInfo = LogInController.HandlePatientInfo();
        Gender = PatientInfo.Gender;
    }

    public void DisplayPatientModel()
    {
        GetGender();

        if (Gender == "G")
        {
            FrontOrBack = "/Images/FemaleFrontcrop.png";
            Width = "212px";
            Height = "477px";
        }

        else if (Gender == "B")
        {
            FrontOrBack = "/Images/MaleFrontCrop.png";
            Width = "270px";
            Height = "520px";
        }
    }

    Task StartupTask()
    {
        return Task.CompletedTask;
    }

    protected override async Task OnInitializedAsync()
    {
        DisplayPatientModel();
        await StartupTask();
    }


    //Zoom forsøg - virker ikke helt med event
    //https://stackoverflow.com/questions/54222913/scrollable-image-stack-using-blazor-component/54227687

    int imgNumber = 0;
    string img => $"/Images/FemaleBackCrop {imgNumber}.png";
    string img2 => $"/Images/pin.png";

    public class WheelEventArgs : Microsoft.AspNetCore.Components.Web.MouseEventArgs { public int DeltaY { get; } }



    Task MouseWheel(WheelEventArgs args)
    {
        imgNumber += Math.Sign(args.DeltaY);
        if (imgNumber == 43) imgNumber = 0;
        if (imgNumber == -1) imgNumber = 42;
        return Task.CompletedTask;
    }


    public string NewPinAdded { get; set; }
    public bool ButtonPressed{ get; set; }
    public bool PointClicked { get; set; }

    private void AddNewCollection(MouseEventArgs e)
    {
        NewPinAdded = "pin.png";
        ButtonPressed = true;
    }

    private void GetCoordinates(MouseEventArgs e)
    {
        double x = e.ScreenX;
        double y = e.ScreenY;

        //if (obj.ScreenX > 1000 && obj.ScreenX < 1200)
        //{
        //    Point mousePoint = new Point((int)obj.ScreenX, (int)obj.ScreenY);
        //    Debug.WriteLine("Koordinaterne er {0}, {1}", obj.ScreenX, obj.ScreenY);
        //}
    }

    private void NavigateToCollectionPage()
    {
        NavManager.NavigateTo("/collectionPage");
    }
}