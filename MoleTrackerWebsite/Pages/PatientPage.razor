@page "/PatientPage"
@using Microsoft.AspNetCore.Mvc.Diagnostics
@using DataClasses.Domain
@using System.Reflection.Metadata
@using System.Xml;
@using System.Xml.Linq
@using System.Xml.XPath
@using BusinessLogicLayer
@using BusinessLogicLayer.BusinessLogicLayerInterfaces

@inject ISelectPatientController SelectPatientController
@inject IViewCollectionController ViewCollectionController
@inject PatientDataDomain PatientDataModel
@inject NavigationManager NavManager;


<h3>@patientInfo.Name</h3>

<!--<div class="row align-items-start" style="height: auto; width: auto">

    <div class="col">
        <div class="tabelcontainer" style="overflow: scroll; height: 500px; width: 400px">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Personlige samlinger</th>
                    </tr>
                </thead>
                <tbody @onclick=NavigateToCollectionPage style="cursor:pointer">
                    @foreach (Collection collection in collections)
                    {
                        <tr>
                            <td>@collection.CollectionName</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>


    <div class="col">-->
        @*padding og sticky*@
        <!--<div style="width: 400px;">
            <a href="~/Images/pin.png" />
            @if (AddButtonPressed == true)
            {
                <img class="cursor" id="PatientModel" src="@FrontOrBack" style="float: right; width: @Width; height: @Height;" @onclick="GetCoordinates" />--> @*onmousewheel="@MouseWheel"*@
            <!--}
            else
            {
                <img id="PatientModel" src="@FrontOrBack" style="float: right; width: @Width; height: @Height;" @onclick="GetCoordinates" />--> @*onmousewheel="@MouseWheel"*@
            <!--}

            <button style="float: right" class="@Arrow" @onclick="TurnAroundModel"></button>

        </div>
    </div>-->

    @*636*1431 billedstørrelse*@



<!--</div>-->

<div class="col">
<EditForm Model="@PatientDataModel">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <table>
        <tbody>
            <tr>
                <th>Modermærker</th>
            </tr>
            @foreach (var collection in CollectionList)
            {
                <tr @onclick="@((e) => NavigateToCollectionPage(e, collection.CollectionID))" style="cursor: pointer">
                    <td>
                        @collection.CollectionName
                    </td>
                </tr>
            }
        </tbody>
    </table>
</EditForm>
</div>
<div class="col">
    <img src="~/css/Pictures/MaleFront.png" alt="Image not found" width="200" height="400" />
</div>

@code {

    private PatientInfoDomain patientInfo;
    public PatientDataDomain PatientData { get; set; }
    public List<CollectionDomain> CollectionList { get; set; }
    public string NameOfPatient { get; set; }
    public List<PictureDataDomain> PicDataList { get; set; }

    protected override async Task OnInitializedAsync()
    {
        //Bare for ikke at smide exception
        PatientData = new PatientDataDomain();
        CollectionList = PatientData.CollectionList;
        //patientData.CollectionList = new List<CollectionDomain>();

        patientInfo = SelectPatientController.SelectedPatient;

        NameOfPatient = patientInfo.Name;

        //patientData = SelectPatientController.GetPatientData(patientInfo);
    }

    private void NavigateToCollectionPage(MouseEventArgs e, object collectionId)
    {

        var selectedCollection = PatientData.CollectionList.Where(x => x.CollectionID.Equals(collectionId)).ToList();

        ViewCollectionController.SelectedCollection = selectedCollection[0];

        NavManager.NavigateTo("/CollectionPage");

    }

}
